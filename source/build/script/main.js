(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(t,n){for(var o=0;o<n.length;o++){var r=n[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(void 0,c=function(t,n){if("object"!==e(t)||null===t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var r=o.call(t,"string");if("object"!==e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(r.key),"symbol"===e(c)?c:String(c)),r)}var c}const n=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url="http://localhost:3000"}var n,o;return n=e,(o=[{key:"getClients",value:function(){return fetch(this.url+"/api/clients").then((function(e){return e.json()}))}},{key:"setClients",value:function(e){return fetch(this.url+"/api/clients",{method:"POST",body:JSON.stringify(e)}).then((function(e){return e.json()}))}},{key:"getClient",value:function(e){return fetch(this.url+"/api/clients/"+e).then((function(e){return e.json()}))}},{key:"setRewrite",value:function(e,t){return fetch(this.url+"/api/clients/"+e,{method:"PATCH",body:JSON.stringify(t)}).then((function(e){return e.json()}))}},{key:"removeClient",value:function(e){return fetch(this.url+"/api/clients/"+e,{method:"DELETE"}).then((function(e){return e.json()}))}},{key:"searchClient",value:function(e){return fetch(this.url+"/api/clients?search="+e).then((function(e){return e.json()}))}}])&&t(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),e}());function o(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}window.addEventListener("DOMContentLoaded",(function(){var e=[],t=document.getElementById("header__search"),r=document.querySelectorAll(".people__table-button"),c=document.querySelector(".people__table-preloader"),a=document.getElementById("people__add"),l=document.getElementById("modal"),u=document.querySelector("#form-surname"),i=document.querySelector("#form-name"),s=document.querySelector("#form-lastname"),d=document.querySelector("#title"),m=document.querySelector("#cancel"),p=document.querySelector("#save"),f=document.querySelector("#remove"),_=document.querySelector("#addContact"),y=document.querySelector("#newContact"),v=document.querySelector("#newContactInput"),S=l.querySelector(".modal__content");function w(){n.getClients().then((function(t){c.style.display="none",a.disabled=!1,N(e=t)}))}function h(e){var t=e.querySelector(".cancel"),r=e.querySelector(".addContact"),c=e.querySelector(".save"),a=e.querySelector(".remove"),u=e.querySelector(".resave");t&&t.addEventListener("click",(function(){k(e.closest(".modal__content"))})),r&&r.addEventListener("click",(function(){var e=C(),t=document.createElement("div");t.classList.add("modal__new-contact"),E([e[0].querySelector(".dropdown")]),g([e[1].querySelector(".modal__new-contact__wrapp")]),t.append.apply(t,o(e)),r.before(t)})),u&&u.addEventListener("click",(function(e){var t=e.currentTarget.closest("form"),o=[];if(L(e.currentTarget.closest("form").querySelectorAll(".req-input"))){var r={name:t.name.value.trim(),surname:t.surname.value.trim(),lastName:t.lastname.value.trim()};t.querySelector(".modal__new-contact")&&t.querySelectorAll(".modal__new-contact").forEach((function(e){""!==e.querySelector(".modal__new-contact__input").value.trim()&&o.push({type:e.querySelector(".dropdown__select").textContent,value:e.querySelector(".modal__new-contact__input").value})})),r.contacts=o,n.setRewrite(t.dataset.client,r).then((function(){k(l.querySelector(".modal__content")),q(),w()}))}})),a&&a.addEventListener("click",(function(){n.removeClient(e.dataset.client).then((function(){k(l.querySelector(".modal__content")),q(),w()}))})),c&&c.addEventListener("click",(function(e){var t=e.currentTarget.closest("form"),o=[];if(L(e.currentTarget.closest("form").querySelectorAll(".req-input"))){var r={name:t.name.value.trim(),surname:t.surname.value.trim(),lastName:t.lastname.value.trim()};t.querySelector(".modal__new-contact")&&t.querySelectorAll(".modal__new-contact").forEach((function(e){""!==e.querySelector(".modal__new-contact__input").value.trim()&&o.push({type:e.querySelector(".dropdown__select").textContent,value:e.querySelector(".modal__new-contact__input").value})})),r.contacts=o,n.setClients(r).then((function(){k(l.querySelector(".modal__content")),q(),w()}))}}))}function q(){c.style.display="block",document.querySelectorAll('div[data-status="info"]').forEach((function(e){e.remove()}))}function b(e){e.forEach((function(e){e.addEventListener("input",(function(e){e.currentTarget.value=e.currentTarget.value.replace(/[,.?!~@#/\d]/g,"")}))}))}function L(e){var t=!0;return e.forEach((function(e){e.querySelector("input").classList.remove("req-input_empty"),""===e.querySelector("input").value.trim()&&(t=!1,e.querySelector("input").classList.add("req-input_empty"))})),t}function g(e){e.forEach((function(e){e.querySelector(".modal__new-contact__svg").addEventListener("click",(function(){e.closest(".modal__new-contact").remove()}))}))}function E(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.querySelectorAll(".dropdown");e.forEach((function(e){var t=e.querySelector(".dropdown__element_select"),n=e.querySelector(".dropdown__select");t&&(n.textContent=t.textContent),n.addEventListener("click",(function(t){document.querySelectorAll(".dropdown").forEach((function(e){e!==t.currentTarget.closest(".dropdown")&&e.classList.remove("dropdown_show")})),e.classList.toggle("dropdown_show"),e.querySelectorAll(".dropdown__element").forEach((function(e){e.addEventListener("click",(function(e){e.currentTarget.closest(".dropdown").classList.remove("dropdown_show"),e.currentTarget.closest(".dropdown__list").querySelector(".dropdown__element_select").classList.remove("dropdown__element_select"),e.currentTarget.classList.add("dropdown__element_select"),n.textContent=e.currentTarget.textContent}))}))}))}))}function C(){return[y.content.cloneNode(!0),v.content.cloneNode(!0)]}function T(e){var t=document.createElement("form");return t.classList.add("modal__form"),t.append.apply(t,o(e)),t}function N(e){e.forEach((function(e){!function(e){var t=document.querySelector(".people__table");for(var n in e)t.append(e[n])}(function(e){var t={id:document.createElement("div"),name:document.createElement("div"),create:document.createElement("div"),update:document.createElement("div"),contacts:document.createElement("div"),button:document.createElement("div")},r=new Date(e.createdAt),c=new Date(e.updatedAt),a=function(e){var t=[];return e.forEach((function(e,n){t.push(document.createElement("div"));var o=document.createElement("div"),r=document.createElement("div");t[n].classList.add("tooltip","Телефон"===e.type?"tel":"Другое"===e.type?"other":e.type),o.classList.add("tooltip__marker"),r.classList.add("tooltip__popup"),o.tabIndex=0,r.textContent=e.value,t[n].append(o,r)})),t}(e.contacts);for(var l in t)t[l].classList.add("people__table-line"),t[l].dataset.status="info",t[l].dataset.client=e.id;t.id.textContent=e.id,t.name.textContent="".concat(e.surname," ").concat(e.name," ").concat(e.lastName);var y=document.createElement("span"),v=document.createElement("span"),w=document.createElement("span"),q=document.createElement("span");y.classList.add("people__table-data"),v.classList.add("people__table-time"),w.classList.add("people__table-data"),q.classList.add("people__table-time"),t.id.classList.add("people__table-id"),t.button.classList.add("people__table-edit-wrapp"),y.textContent="".concat(r.getDate(),".").concat(r.getMonth()+1,".").concat(r.getFullYear()),v.textContent="".concat(r.getHours(),":").concat(r.getMinutes()),w.textContent="".concat(c.getDate(),".").concat(c.getMonth()+1,".").concat(c.getFullYear()),q.textContent="".concat(c.getHours(),":").concat(c.getMinutes()),t.create.append(y,v),t.update.append(w,q),a.forEach((function(e){t.contacts.append(e)}));var L=document.createElement("button"),N=document.createElement("button");return L.classList.add("people__table-button","people__table-edit"),N.classList.add("people__table-button","people__table-remove"),L.textContent="Изменить",N.textContent="Удалить",L.addEventListener("click",(function(e){n.getClient(e.currentTarget.closest('div[data-status="info"]').dataset.client).then((function(e){var t=u.content.cloneNode(!0),n=i.content.cloneNode(!0),r=s.content.cloneNode(!0),c=d.content.cloneNode(!0),a=m.content.cloneNode(!0),l=_.content.cloneNode(!0),f=p.content.cloneNode(!0);c.querySelector("h2").textContent="Изменить данные",b([n.querySelector("input"),t.querySelector("input"),r.querySelector("input")]),t.querySelector("input").value=e.surname,n.querySelector("input").value=e.name,r.querySelector("input").value=e.lastName,f.querySelector(".save").classList.add("resave"),f.querySelector(".save").classList.remove("save");var y=T([c,t,n,r,l,f,a]);y.dataset.client=e.id,S.append(y),e.contacts.length>0&&e.contacts.forEach((function(e){var t=C(),n=document.createElement("div");n.classList.add("modal__new-contact"),t[1].querySelector("input").value=e.value,t[0].querySelectorAll(".dropdown__element").forEach((function(t){t.classList.remove("dropdown__element_select"),t.textContent===e.type&&t.classList.add("dropdown__element_select")})),E([t[0].querySelector(".dropdown")]),g([t[1].querySelector(".modal__new-contact__wrapp")]),n.append.apply(n,o(t)),y.querySelector(".addContact").before(n)})),h(y),A()}))})),N.addEventListener("click",(function(e){var t=d.content.cloneNode(!0),n=m.content.cloneNode(!0),o=f.content.cloneNode(!0),r=document.createElement("p");r.classList.add("modal__message"),r.textContent="Вы действительно хотите удалить данного клиента?",t.querySelector("h2").textContent="Удалить клиента";var c=T([t,r,o,n]);c.dataset.client=e.currentTarget.closest('div[data-status="info"]').dataset.client,S.append(c),h(c),A()})),t.button.append(L),t.button.append(N),t}(e))}))}function A(){l.classList.add("modal_active");var e=l.querySelector(".modal__close"),t=l.querySelector(".modal__wrap");l.addEventListener("click",(function(e){e.composedPath().includes(t)||k(l.querySelector(".modal__content"))})),e.addEventListener("click",(function(){k(l.querySelector(".modal__content"))}))}function k(e){l.classList.remove("modal_active"),e.innerHTML=""}w(),t.addEventListener("input",(function(t){q(),c.style.display="block",""===t.currentTarget.value.trim()?w():n.searchClient(t.currentTarget.value.trim()).then((function(t){c.style.display="none",N(e=t)}))})),r.forEach((function(t){t.addEventListener("click",(function(t){q(),t.currentTarget.classList.toggle("people__table-button_active"),"id"===t.currentTarget.dataset.sort?t.currentTarget.classList.contains("people__table-button_active")?e.sort((function(e,t){return t.id-e.id})):e.sort((function(e,t){return e.id-t.id})):"fio"===t.currentTarget.dataset.sort?t.currentTarget.classList.contains("people__table-button_active")?e.sort((function(e,t){var n=e.name.toLowerCase()+" "+e.surname.toLowerCase()+" "+e.lastName.toLowerCase(),o=t.name.toLowerCase()+" "+t.surname.toLowerCase()+" "+t.lastName.toLowerCase();return n<o?-1:n>o?1:0})):e.sort((function(e,t){var n=e.name.toLowerCase()+" "+e.surname.toLowerCase()+" "+e.lastName.toLowerCase(),o=t.name.toLowerCase()+" "+t.surname.toLowerCase()+" "+t.lastName.toLowerCase();return n<o?1:n>o?-1:0})):"create"===t.currentTarget.dataset.sort?t.currentTarget.classList.contains("people__table-button_active")?e.sort((function(e,t){return new Date(t.createdAt)-new Date(e.createdAt)})):e.sort((function(e,t){return new Date(e.createdAt)-new Date(t.createdAt)})):"update"===t.currentTarget.dataset.sort&&(t.currentTarget.classList.contains("people__table-button_active")?e.sort((function(e,t){return new Date(t.updatedAt)-new Date(e.updatedAt)})):e.sort((function(e,t){return new Date(e.updatedAt)-new Date(t.updatedAt)}))),N(e),c.style.display="none"}))})),a.addEventListener("click",(function(){var e=u.content.cloneNode(!0),t=i.content.cloneNode(!0),n=s.content.cloneNode(!0),o=d.content.cloneNode(!0),r=m.content.cloneNode(!0),c=_.content.cloneNode(!0),a=p.content.cloneNode(!0);o.querySelector("h2").textContent="Новый клиент",b([t.querySelector("input"),e.querySelector("input"),n.querySelector("input")]);var l=T([o,e,t,n,c,a,r]);S.append(l),h(l),A()}))}))})();